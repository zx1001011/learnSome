// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../layers/support/fieldUtils ../../../popup/support/FieldInfoFormat ../../../popup/FieldInfo ../../../popup/ExpressionInfo ../../../PopupTemplate ../../../intl/substitute ../../../intl/messages ../../support/clusterUtils ../../../views/2d/layers/support/clusterUtils".split(" "),function(x,A,B,C,D,E,r,F,l,G){function t(a){const {fieldName:c,label:e,type:b}=a;a=-1<A.numericTypes.indexOf(b);a=new C({fieldName:c,label:e,visible:!0,format:a?{places:"integer"===b||"small-integer"===
b?0:2,digitSeparator:!0}:null});"date"===b&&(a.format=new B({dateFormat:"short-date-short-time"}));return a}function n(a,c){return(a=c.getField(a))&&(a.alias||a.name)}function y(a,c,e,b){const {attributeInfo:m,statisticType:f}=c,{field:h,normalizationField:k}=m;c="";let d;"avg"===f?d=k?b.clusters.avgNormFieldSummary:b.clusters.avgFieldSummary:"type"===f&&(d=b.clusters.predominantFieldSummary);d&&(b=m.valueExpression?m.valueExpressionTitle:n(h,a),a=k&&n(k,a),c=r.substitute(d,{fieldLabel:b||"",normFieldLabel:a||
"",fieldValue:"{"+e+"}"}));return c}x.createPopupTemplate=async function(a,c){if(!G.isClusterCompatibleRenderer(c))return null;var e=l.getStatisticInfos(a,c);const b=await F.fetchMessageBundle("esri/smartMapping/t9n/smartMapping"),m=b.clusters.predominantNoneValue;c="unique-value"===c.type?c.uniqueValueInfos:[];const f=[],h=[],k=[];f.push(r.substitute(b.clusters.countSummary,{count:`{${l.clusterCountField}}`}));h.push(t({fieldName:l.clusterCountField,label:b.clusters.numFeatures,type:"integer"}));
for(const p of e){const {statisticType:u,attributeInfo:H}=p;e=l.getClusterField(H,u);{var d=void 0;var g=a;const {attributeInfo:v,statisticType:z}=p,{field:I,normalizationField:w}=v;var q="";"avg"===z?d=w?b.clusters.avgNormFieldLabel:b.clusters.avgFieldLabel:"type"===z&&(d=b.clusters.predominantFieldLabel);d&&(q=v.valueExpression?v.valueExpressionTitle:n(I,g),g=w&&n(w,g),q=r.substitute(d,{fieldLabel:q||"",normFieldLabel:g||""}));d=q}"avg"===u?(f.push(y(a,p,e,b)),h.push(t({fieldName:e,label:d,type:"double"}))):
"type"===u&&(g=`expression/${e}`,f.push(y(a,p,g,b)),k.push(new D({name:e,title:d,returnType:"string",expression:l.getPredominantTypeExpression(c,e,m)})),h.push(t({fieldName:g})))}return new E({fieldInfos:h,expressionInfos:k,content:f.join("\x3cbr/\x3e\x3cbr/\x3e")})};Object.defineProperty(x,"__esModule",{value:!0})});