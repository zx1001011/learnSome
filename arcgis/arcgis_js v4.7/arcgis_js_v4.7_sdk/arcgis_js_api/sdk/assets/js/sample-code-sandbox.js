/*! ArcGIS API for JavaScript 4.7 | Copyright (c) 2018 Esri. All rights reserved. | http://www.esri.com/legal/privacy | https://developers.arcgis.com/terms/faq */
require(["calcite-web","beautify-web/beautify-html","eligrey/FileSaver","mousetrap","dojo/_base/connect","dojo/_base/event","dojo/dom-construct","dojo/dom-style","dojo/has","dojo/on","dojo/query","esri/config","esri/core/urlUtils","esri/request","dojo/NodeList-dom","dojo/domReady!"],function(e,n,t,o,a,i,s,r,c,d,l,m,u,f){function p(){J&&b(),U.toggleClass("sandbox-container-minimized"),D.toggleClass("sandbox-output-maximized"),A.toggleClass("sandbox-container-minimized"),y(),O.resize(!0),G=!G}function b(){G&&p(),U.toggleClass("sandbox-container-maximized"),D.toggleClass("sandbox-output-minimized"),A.toggleClass("sandbox-container-minimized"),y(),O.resize(!0),J=!J}function g(){var e=H.attr("data-sample-description-url")[0];document.location=e}function h(){E("saveFile");try{if(!!new Blob){var e=new Blob([O.getSession().getValue()],{type:"text/plain;charset='"+document.characterSet+"'"});t(e,q+".html")}}catch(e){console.log("Download is not supported for %s",navigator.userAgent)}}function x(){E("openJSShare");var e=window.open("about:blank",function(){function e(e){for(var n="",t=0;t<e;t++)n+=(65536*(1+Math.random())|0).toString(16).substring(1);return n}return[e(2),e(1),e(1),e(1),e(3)].join("-")}()),n=O.getSession().getValue(),t=j(n);localStorage&&localStorage.jsShareType&&(X=localStorage.jsShareType);var o,a=["html"],i=e.document.createElement("form");"jsbin"===X?W="https://jsbin.com?html,output":"codepen"===X&&(W="https://codepen.io/pen/define/"),i.setAttribute("target","_self"),i.setAttribute("method","post"),i.setAttribute("action",W),i.style.display="none";for(var s=0;s<a.length;s++)o=e.document.createElement("input"),i.appendChild(o),o.type="hidden","jsbin"===X?(o.name=a[s],o.value=encodeURIComponent(t)):"codepen"===X?(Y.html=t.replace(/<!DOCTYPE html>\n?/i,""),o.name="data",o.value=JSON.stringify(Y)):o.value="";e.document.body.appendChild(i),i.submit()}function v(e){function n(e,n){U[0].style.right=n-e+"px",D[0].style.left=e+"px"}i.stop(e),A.addClass("resizing"),I.addClass("resizing");var t=r.get("wrapper","width"),o=d(window,"mousemove",function(e){i.stop(e),e.pageX>50&&e.pageX+70<t&&(n(e.pageX+11,t),O.resize(!0))});d.once(parent.document,"mouseup",function(e){A.removeClass("resizing"),I.removeClass("resizing"),a.disconnect(o)})}function y(){D.removeAttr("style"),U.removeAttr("style")}function C(){E("updateSandboxOutput"),N.addClass("is-active"),I=l(".js-sandbox-iframe"),I&&s.destroy(I[0]),k&&a.disconnect(k);var e=s.create("iframe",{class:"sandbox-iframe js-sandbox-iframe",allowfullscreen:"true"},D[0]);k=d(e,"load",function(){I=l(".js-sandbox-iframe"),N.removeClass("is-active"),M.removeClass("btn-disabled")}),E("sandboxIsLoaded"),idoc=e.contentWindow?e.contentWindow:e.contentDocument.document?e.contentDocument.document:e.contentDocument;var n=O.getSession().getValue();n=z(n),c("ie")?(idoc.contents=n,e.src="javascript:window['contents']"):(idoc.document.open(),idoc.document.write(n),idoc.document.close())}function S(){var e={brace_style:"none",end_with_newline:!1,extra_liners:"",indent_size:2,max_preserve_newlines:2,preserve_newlines:!0,wrap_line_length:80},t=O.getSession().getValue(),o=n.html_beautify(t,e);O.getSession().setValue(o)}function j(e){var n=e,t=/<title>[^<]*<\/title>/im,o=e.match(t),a=o?o[0]:"",i=a.replace(/<\/?title>/gim,"");if(Y.title=i,a&&""!==a){var s=_.match(/[-\w]*(?=\/live(\/index\.html)?)/im),r=s?s[0]:"sample",c="https://developers.arcgis.com/javascript/latest/"+r+"/index.html",d="";"jsbin"===X&&(d+='<meta name="description" content="['+i+']">\n  '),d+="\x3c!--\n  ArcGIS API for JavaScript, https://js.arcgis.com\n  For more information about the {{ sample_name }} sample, read the original sample description at developers.arcgis.com.\n  {{ sample_url }}\n  --\x3e\n".replace(/{{\ssample_name\s}}/,r).replace(/{{\ssample_url\s}}/,c)+a,n=e.replace(t,d)}return n}function w(){F=document.documentElement.getAttribute("data-platform"),/mac/i.test(F)&&e.addClass(e.findElements("body")[0],"macintosh"),e.bus.on("keyboard:mousetrap",function(n){var t=n.event.key,o=n.combination;"?"===t?e.bus.emit("modal:open","modal-keyboard-shortcuts"):"s"===t&&"g s"===o?g():"c"===t?(n.event.preventDefault(),O.isFocused()||O.focus()):"d"===t?h():"s"===t?x():"Enter"!==t||"command+enter"!==o&&"ctrl+enter"!==o?"h"===t&&"t h"===o?p():"o"===t&&"t o"===o&&b():C()}),o.bind(["g s","c","d","s","command+enter","ctrl+enter","t h","t o","?"],function(n,t){e.bus.emit("keyboard:mousetrap",{event:n,combination:t})})}function z(e){var n=e.match(/issMeshUrl = ".+?"/g);if(n&&(n=n.filter(function(e){return-1===e.indexOf("//")}),n.forEach(function(n){var t=n.split('"')[1];e=e.replace(t,_+"/"+t)})),n=e.match(/url = ".+?"/g),n&&(n=n.filter(function(e){return-1===e.indexOf("//")}),n.forEach(function(n){var t=n.split('"')[1];e=e.replace(t,_+"/"+t)})),n=e.match(/".\/Clock.js"/g),n&&(n=n.filter(function(e){return-1===e.indexOf("//")}),n.forEach(function(n){var t=n.split('"')[1];e=e.replace(t,_+"/"+t)})),n=e.match(/".\/clock.svg"/g),n&&(n=n.filter(function(e){return-1===e.indexOf("//")}),n.forEach(function(n){var t=n.split('"')[1];e=e.replace(t,_+"/"+t)})),n=e.match(/image: ".+?"/g),n&&(n=n.filter(function(e){return-1===e.indexOf("//")}),n.forEach(function(n){var t=n.split('"')[1];e=e.replace(t,_+"/"+t)})),n=e.match(/url: ".+?"/g),n&&(n=n.filter(function(e){return-1===e.indexOf("//")}),n.forEach(function(n){var t=n.split('"')[1];e=e.replace(t,_+"/"+t)})),n=e.match(/src='.+?'/g),n&&(n=n.filter(function(e){return-1===e.indexOf("//")}),n.forEach(function(n){var t=n.split("'")[1];e=e.replace(t,_+"/"+t)})),n=e.match(/getUniqueValueSymbol\(".+?"/g),n&&(n=n.filter(function(e){return-1===e.indexOf("//")}),n=n.filter(function(e){return-1===e.indexOf("{")}),n.forEach(function(n){var t=n.split('"')[1];e=e.replace(t,_+"/"+t)})),n=e.match(/src=".+?"/g),n&&(n=n.filter(function(e){return-1===e.indexOf("//")}),n=n.filter(function(e){return-1===e.indexOf("{")}),n.forEach(function(n){var t=n.split('"')[1];e=e.replace(t,_+"/"+t)})),n=e.match(/"dojo\/text!.+?"/g),n&&(n=n.filter(function(e){return-1===e.indexOf("//")}),n.forEach(function(n){var t=n.split('"')[1];e=e.replace(t,"dojo/text!"+_+"/brightest.txt")})),/layers-scenelayerview-query/.test(_)){var t=/<img[^>]*>/im,o=new RegExp(_+"/");if(t.test(e)){var a=e.match(t)[0],i=a.replace(o,"");e=e.replace(t,i)}}return e}function E(e){P&&console&&console.log&&console.log(Array.prototype.slice.call(arguments))}var O,F,q,_,k,K,A,T,L,H,M,V,D,I,U,N,P=!1,R=14.11,B=18,G=!1,J=!1,X="codepen",W="https://codepen.io/pen/define/",Y={title:"My first sample",editors:"100",html:"",layout:"left"};m.request.corsEnabledServers.push("https://developers.arcgis.com/javascript/samples"),e.init(),function(){E("setSampleFolder");var e=u.urlToObject(document.location.href);e.query=e.query||{};var n=document.location.pathname.replace("sample-code/sandbox/index.html","");e.query&&e.query.sample?(q=e.query.sample,document.title="Sandbox: "+q,_=document.location.protocol+"//"+document.location.host+n+"sample-code/"+e.query.sample+"/live"):_=n+"sample-code/intro-mapview/live"}(),function(){E("startEditor"),ace.config.set("workerPath","../../assets/js/libs/ace");var e=l(".js-sandbox-editor")[0];O=ace.edit(e),O.$blockScrolling=1/0,O.setPrintMarginColumn(0),O.setTheme("ace/theme/github"),O.getSession().setTabSize(2),O.getSession().setUseSoftTabs(!0),O.getSession().setMode("ace/mode/html"),O.setOption("wrap",!0),K=R,localStorage&&(localStorage.sandboxFontSize?localStorage.sandboxFontSize&&(K=parseInt(localStorage.sandboxFontSize),O.setFontSize(K)):localStorage.sandboxFontSize=K);var n={current:"ace",ace:null,vim:void 0};ace.config.loadModule("ace/keyboard/vim",function(e){n.vim=e.handler,e.CodeMirror.Vim.defineEx("write","w",function(e,n){e.ace.execCommand("sandboxSaveCommand")})}),O.commands.removeCommand({name:"gotoline",bindKey:{win:"Ctrl-L",mac:"Command-L"}}),O.commands.addCommand({name:"gotoline",bindKey:{win:"Ctrl-Alt-G",mac:"Option-Command-G"},exec:function(e,n){"number"!=typeof n&&(n=parseInt(prompt("Enter line number:"),10)),isNaN(n)||e.gotoLine(n)},readOnly:!0}),O.commands.addCommand({name:"sandboxSaveCommand",bindKey:{win:"Ctrl-Enter",mac:"Command-Enter"},exec:function(e){C()}}),O.commands.addCommand({name:"sandboxKeybindingCommand",bindKey:{win:"Ctrl-K",mac:"Command-K"},exec:function(e){"ace"===n.current?(e.setKeyboardHandler(n.vim),n.current="vim"):(e.setKeyboardHandler(n.ace),n.current="ace")}}),O.commands.addCommand({name:"sandboxCommentLinesCommand",bindKey:{win:"Ctrl-/",mac:"Command-/"},exec:function(e){e.toggleCommentLines()}}),O.commands.addCommand({name:"sandboxBeautifyCommand",bindKey:{win:"Ctrl-Alt-L",mac:"Option-Command-L"},exec:function(e){S()}}),O.commands.addCommand({name:"sandboxToogleHTMLCommand",bindKey:{win:"Ctrl-1",mac:"Ctrl-1"},exec:function(e){p()}}),O.commands.addCommand({name:"sandboxToogleOutputCommand",bindKey:{win:"Ctrl-2",mac:"Ctrl-2"},exec:function(e){b()}}),O.commands.addCommand({name:"sandboxIncreaseFontCommand",bindKey:{win:"Ctrl-Shift-.",mac:"Command-Shift-."},exec:function(e){"use strict";K++,e.setFontSize(K),localStorage.sandboxFontSize=K,K>B&&""===document.querySelector(".js-sandbox-editor").style.lineHeight&&(document.querySelector(".js-sandbox-editor").style.lineHeight=1.4)}}),O.commands.addCommand({name:"sandboxDecreaseFontCommand",bindKey:{win:"Ctrl-Shift-,",mac:"Command-Shift-,"},exec:function(e){"use strict";K--,e.setFontSize(K),localStorage.sandboxFontSize=K,K<B&&""!==document.querySelector(".js-sandbox-editor").style.lineHeight&&(document.querySelector(".js-sandbox-editor").style.lineHeight="")}}),O.commands.addCommand({name:"sandboxResetFontCommand",bindKey:{win:"Ctrl-0",mac:"Command-0"},exec:function(e){"use strict";e.setFontSize(R),K=R,localStorage&&delete localStorage.sandboxFontSize,document.querySelector(".js-sandbox-editor").style.lineHeight="",document.querySelector(".js-sandbox-editor").style.fontSize=""}}),O.commands.addCommand({name:"blur",bindKey:{win:"Shift-Esc",mac:"Shift-Esc"},exec:function(e){"use strict";e.isFocused()&&e.blur()}})}(),function(){E("bindEventHandlers"),H=l(".js-btn-sample-description"),L=l(".js-btn-save-file"),T=l(".js-btn-jsshare"),M=l(".js-btn-refresh"),U=l(".js-sandbox-container"),A=l(".js-sandbox-handle"),D=l(".js-sandbox-output"),N=l(".js-loader"),H.on("click",g),L.on("click",h),T.on("click",x),M.on("click",C),V=l(".js-btn-sandbox-keyboard-shortcuts"),V.on("click",function(){e.bus.emit("modal:open","modal-keyboard-shortcuts")}),w(),A.on("mousedown",v),H.attr("data-sample-description-url","../../sample-code/"+q+"/index.html"),d(window,"resize",y)}(),function(){function e(e){E("handleSample");var n=e.data;O.getSession().setValue(n),H.toggleClass("btn-disabled"),L.removeClass("btn-disabled"),T.removeClass("btn-disabled"),C()}function n(e){console&&console.log&&console.log("error getting code sample: ",e)}E("fetchSandboxSampleCode"),f(_+"/index.html",{responseType:"text"}).then(e,n)}(),window.jsshare=function(e){"jsbin"===e?X="jsbin":"codepen"===e&&(X="codepen"),localStorage.jsShareType=X}});