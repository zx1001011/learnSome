/*! ArcGIS API for JavaScript 4.7 | Copyright (c) 2018 Esri. All rights reserved. | http://www.esri.com/legal/privacy | https://developers.arcgis.com/terms/faq */
define(["dojo/Stateful","dojo/_base/declare","dojo/_base/lang","esri/core/HandleRegistry","esri-playground-js/utils/CodeGenerator","esri-playground-js/utils/ObjectProvider"],function(e,n,t,a,s,i){var c={},o=n([e],{ast:null,config:null,editor:null,statefulObject:null,view:null}),r=function(){c._instance.handles.destroy(),c._instance.handles=null,c._instance.required=null,c._instance=null},l=function(){if(!c._instance){c._instance=new o,c._instance.handles=new a,c._instance.required={paths:[],reqModules:[],commentReqModules:["// Modules required: "],reqVariables:[]};var e=c._instance.watch("ast",function(){var e=c._instance.get("ast");if(e){var n=c._instance.get("config"),t=n.autocastType;if(t){var a=s.getAutocastAST(n.variable,t,e),i=s.generateCode(a);c._instance.editor.getDoc().setValue("// autocasts as new "+n.className+"() \n\n"+js_beautify(i))}else{var o=s.generateCode(e);o=c._instance.required.commentReqModules.join("\n")+"\n\n"+js_beautify(o),c._instance.editor.getDoc().setValue(o)}u("ast")}});c._instance.handles.add(e,"ast-handler");var n=c._instance.watch("config",function(){u("config")});c._instance.handles.add(n,"config-handler");var t=c._instance.watch("statefulObject",function(){f(c._instance.config,c._instance.statefulObject);var e=JSON.parse(sessionStorage.getItem(c._instance.config.className)),n=window.location.hash.split("?")[1],t=n&&JSON.parse(decodeURIComponent(n.split("=")[1]));if(t||e&&e.statefulObject){d(c._instance.statefulObject,t||e.statefulObject);var a=s.constructAST(c._instance);c._instance.set("ast",a)}if(t){var i=window.location.hash;window.location.hash=i.split("?")[0]}});c._instance.handles.add(t,"stateful-handler");var i=c._instance.watch("required",function(){});c._instance.handles.add(i,"required-handler")}return c._instance},u=function(e){var n=c._instance.config&&c._instance.config.className;if(n){var t=JSON.parse(sessionStorage.getItem(n))||{};t[e]=c._instance.get(e),sessionStorage.setItem(n,JSON.stringify(t))}},d=function(e,n){for(var t in n)n[t]instanceof Array?e.set(t,n[t]):n[t]instanceof Object?d(e[t],n[t]):null!=n[t]&&"className"!==t&&e.set(t,n[t])},f=function(e,n){for(var t in n)n[t]instanceof i.StatefulClass&&f(e,n[t]);var a=n.watch(function(n,t,a){if(t!=a){Array.isArray(a)&&"color"!==n?a.forEach(function(n){n instanceof i.StatefulClass&&f(e,n)}):a instanceof i.StatefulClass&&f(e,a);var o=s.constructAST(c._instance);c._instance.set("ast",o),u("statefulObject")}});c._instance.handles.add(a,"obj-watch")};return c.getInstance=l,c.destroy=r,c});