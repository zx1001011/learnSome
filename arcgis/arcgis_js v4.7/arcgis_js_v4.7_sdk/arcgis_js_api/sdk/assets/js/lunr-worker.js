/*! ArcGIS API for JavaScript 4.7 | Copyright (c) 2018 Esri. All rights reserved. | http://www.esri.com/legal/privacy | https://developers.arcgis.com/terms/faq */
"use strict";function hasSearchResults(e){return!!e&&e.length>0}function processAPIReferenceSearchResults(e,s){return new Promise(function(a,r){if(e){var t=e.map(function(e){var a=s[e.ref];if(/\.html#/.test(a.page_url)){var r=/[-\w]*(?=$)/im;a.secondary_search_term=r.test(a.page_url)?a.page_url.match(r)[0]:a.class}else a.secondary_search_term=a.class;return a.tertiary_search_term=a.package+"/"+a.class,a}),o=/[-:.#\w]+(?=["']>)/i,n=t.map(function(e){var s=e.html.match(o);return e.muid=s.length>0?s[0]:e.html,e}),c=n.sort(function(e,s){return s.rank-e.rank||e.secondary_search_term.localeCompare(s.secondary_search_term)||e.tertiary_search_term.localeCompare(s.tertiary_search_term)});a({records:_.sortedUniqBy(c,"muid")})}else a({records:[]})})}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},throttle=function(e,s){var a=void 0,r=void 0,t=void 0;return function(){var o=this,n=arguments;a?(clearTimeout(r),r=setTimeout(function(){Date.now()-t>=s&&(e.apply(o,n),t=Date.now())},s-(Date.now()-t))):(e.apply(o,n),t=Date.now(),a=!0)}};if("function"==typeof importScripts){var workerHref=self.location.href,baseURL=workerHref.replace(/\/lunr-worker\.js[-=?#&_~[\]@!"$'()*+,;:\w\d]*/,"");self.importScripts(baseURL+"/libs/lunr.js",baseURL+"/api-reference-lunr.js",baseURL+"/sample-code-lunr.js",baseURL+"/libs/lodash.js"),"undefined"==typeof Promise&&(self.importScripts(baseURL+"/libs/es6-promise.js"),self.importScripts(baseURL+"/libs/es6-promise.auto.js"));var apiRefSerializedIndex=esriAPIReferenceLunrData.searchindex,apiRefSearchData=esriAPIReferenceLunrData.searchdata,apiRefSearchIndex=lunr.Index.load(apiRefSerializedIndex),isAPIReferenceSearchReady="string"==typeof apiRefSerializedIndex.version&&"object"===(void 0===apiRefSearchData?"undefined":_typeof(apiRefSearchData)),sampleCodeSerializedIndex=esriSampleCodeLunrData.searchindex,sampleCodeSearchData=esriSampleCodeLunrData.searchdata;lunr.tokenizer.separator=/[,s]+/;var sampleCodeSearchIndex=lunr.Index.load(sampleCodeSerializedIndex),isSampleCodeSearchReady="string"==typeof sampleCodeSerializedIndex.version&&"object"===(void 0===sampleCodeSearchData?"undefined":_typeof(sampleCodeSearchData)),readyMessage={type:"ready",sample_code_lunr_index_loaded:isSampleCodeSearchReady,api_reference_lunr_index_loaded:isAPIReferenceSearchReady},searchMilliSecondsDelay=500;onmessage=throttle(function(e){var s=!1,a=e.data,r={messageId:a.messageId,results:[],type:a.type};if("api-reference-search"===a.type){var t=void 0,o=a.value;if(r.value=o,/\*$/g.test(o))t=apiRefSearchIndex.search(o),s=hasSearchResults(t),s?processAPIReferenceSearchResults(t,apiRefSearchData).then(function(e){r.results=e.records,postMessage(r)}):(r.results=[],postMessage(r));else{if(/(\w+\s)+\w+/g.test(o)&&!s){o=o.replace(/\s+/g,"*");try{var n=[],c=[],i=apiRefSearchIndex.search(o);i&&i.length<50&&(n=apiRefSearchIndex.search(o+"*")),i&&i.length<50&&n&&n.length<50&&(c=apiRefSearchIndex.search("*"+o+"*")),t=i.concat(n,c),s=hasSearchResults(t),s?processAPIReferenceSearchResults(t,apiRefSearchData).then(function(e){r.results=e.records,postMessage(r)}):(r.results=[],postMessage(r))}catch(e){r.error=e,postMessage(r),console.log("worker - error: %s",e)}}if(!/\*/g.test(o)&&!/\s/g.test(o)&&!s)try{var l=[],p=[],d=apiRefSearchIndex.search(o);d&&d.length<50&&(l=apiRefSearchIndex.search(o+"*")),d&&d.length<50&&l&&l.length<50&&(p=apiRefSearchIndex.search("*"+o+"*")),t=d.concat(l,p),s=hasSearchResults(t),s?processAPIReferenceSearchResults(t,apiRefSearchData).then(function(e){r.results=e.records,postMessage(r)}):(r.results=[],postMessage(r))}catch(e){r.error=e,postMessage(r),console.log("worker - error: %s",e)}if(!/\*/g.test(o)&&!s)try{t=apiRefSearchIndex.query(function(e){e.term(o,{usePipeline:!0,boost:50}),e.term(o+"*",{usePipeline:!1,boost:10}),e.term(o,{usePipeline:!1,editDistance:2,boost:1})}),s?processAPIReferenceSearchResults(t,apiRefSearchData).then(function(e){r.results=e.records,postMessage(r)}):(r.results=[],postMessage(r))}catch(e){r.error=e,postMessage(r),console.log("worker - error: %s",e)}}}else if("sample-code-search"===a.type){var h=void 0,f=a.value,u={title:[],tags:[]};if(r.value=f,/(\s|\*$)/.test(f))h=sampleCodeSearchIndex.search(f);else if(/\d\.\d/.test(f))h=sampleCodeSearchIndex.search(f);else try{h=sampleCodeSearchIndex.query(function(e){e.term(f,{usePipeline:!0,boost:50}),e.term(f+"*",{usePipeline:!1,boost:10}),e.term(f,{usePipeline:!1,editDistance:2,boost:1})})}catch(e){r.error=e,postMessage(r),console.log("Error: %s",e)}var m=[];Object.keys(h).forEach(function(e){var s=h[e].matchData.metadata,a=sampleCodeSearchData[h[e].ref],r=sampleCodeSearchData[h[e].ref],t=!(void 0!==r.is_external_sample&&!r.is_external_sample),o=!(void 0!==r.sandbox&&!r.sandbox),n=!(void 0!==r.jsshare&&!r.jsshare);Object.keys(s).forEach(function(e){Object.keys(s[e]).forEach(function(r){if(s[e][r]){var t=s[e][r].position;a[r]&&u[r].push(a[r].substr(t[0][0],t[0][1]))}})}),m.push({result:a,pageMeta:r,isExternalSample:t,sandboxEnabled:o,jsShareEnabled:n})}),r.results=m,r.matchTags=u,postMessage(r)}else console.log("Posting message back to main script"),postMessage(r)},searchMilliSecondsDelay),self.postMessage(readyMessage)}else console.log("worker - importScripts is undefined");